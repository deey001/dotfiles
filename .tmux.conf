# ~/.tmux.conf - Modern configuration with productivity enhancements

# Terminal Settings
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:RGB"
set -ga terminal-overrides ",alacritty:RGB"  # Adjust for your terminal if needed (e.g., "wezterm:RGB")
set -g escape-time 0
set -g extended-keys on  # Better key handling for modern apps

# Prefix and Base Settings
unbind C-b
set -g prefix C-a
bind C-a send-prefix
set -g prefix2 C-s  # Secondary prefix for ergonomic variety
bind C-s send-prefix -2
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g history-limit 1000000  # Large history for heavy logging
set -g mouse on
set -g focus-events on
set -g aggressive-resize on  # Dynamic window resizing
set -g detach-on-destroy off  # Switch to another session if current is destroyed

# Key Bindings - Vi Mode
setw -g mode-keys vi
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# Smart Pane Switching (Vim-aware)
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -r h if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -r j if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -r k if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -r l if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'

# Pane Splitting
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Pane Resizing
bind -r H resize-pane -L 10
bind -r J resize-pane -D 10
bind -r K resize-pane -U 10
bind -r L resize-pane -R 10

# New Session Prompt
bind C command-prompt -p "New Session:" "new-session -A -s '%%'"

# Fuzzy Session Switching (requires fzf)
bind f new-window -n "session-switcher" "tmux list-sessions | sed -E 's/:.*$//' | grep -v \"^$(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t"

# Copy Mode and Clipboard (Cross-Platform)
bind -T copy-mode-vi v send-keys -X begin-selection
if-shell "uname | grep -q Darwin" "bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy'"
if-shell "uname | grep -q Linux && command -v wl-copy" "bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'wl-copy'"
if-shell "uname | grep -q Linux && command -v xclip" "bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'"
set -g set-clipboard on

# Status Bar
set -g status-position top
set -g status-style "bg=colour235,fg=colour137"
set -g status-left "#[fg=green,bold]#S #[fg=default]"
set -g status-right "#[fg=cyan]#(git -C #{pane_current_path} rev-parse --abbrev-ref HEAD 2>/dev/null) | #[fg=green]#H | %m/%d/%y %I:%M"
if-shell "uname | grep -q Darwin" "set -ag status-right ' | #(sysctl -n hw.sensors.battery0.percent)%%'"
if-shell "uname | grep -q Linux" "set -ag status-right ' | #(cat /proc/loadavg | cut -d\" \" -f1-3)'"
set -g window-status-current-style "bg=blue,fg=black"
set -g pane-border-style "fg=colour235,bg=black"
set -g pane-active-border-style "fg=green,bg=black"

# Hypothetical AI Integration (Adjust to your CLI tool, e.g., for Grok-like assistance)
# bind g split-window -h "python -m grok_cli --prompt"  # Uncomment and customize if desired

# Plugins (Install with prefix + I)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-thumbs'  # Quick selections
set -g @plugin 'catppuccin/tmux'  # Modern theme
set -g @catppuccin_flavour 'mocha'  # Or 'latte' for light

set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '5'  # Every 5 minutes

# Initialize TPM (must be at the end)
run '~/.tmux/plugins/tpm/tpm'
